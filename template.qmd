---
title: "Lab 06"
subtitle: "$K$NN and PCA"
jupyter: julia-1.9
date: 2023-10-13
author: Riley Becker (rb111)
---

# 1. Intro
```{julia}
import Pkg; Pkg.add("MultivariateStats")
import Pkg; Pkg.add("Plots")
import Pkg; Pkg.add("NCDatasets")
import Pkg; Pkg.add("StatsBase")
import Pkg; Pkg.add("Unitful")
```
```{julia}
import Pkg; Pkg.add("DataFrames")
```
```{julia}
using Dates
using MultivariateStats
using Plots
using NCDatasets
using StatsBase
using Unitful
using DataFrames
Plots.default(; margin=4Plots.mm, size=(700, 400), linewidth=2)
```

# 2. Data
## 2a. Precipitation Data
```{julia}
precip_ds = NCDataset("data/raw/precip_tx.nc")
```
```{julia}
precip_time = precip_ds["time"][:]
precip_lon = precip_ds["lon"][:]
precip_lat = precip_ds["lat"][:]
precip_lat = reverse(precip_lat)
precip = (precip_ds["precip"][:, :, :])
precip = reverse(precip, dims=2)
```
```{julia}
precip = precip.* 1u"mm"
```
```{julia}
close(precip_ds)
```
```{julia}
heatmap(precip_lon, precip_lat, precip[:,:,1]'; xlabel= "longitude", ylabel="Latitude", title= "Precipitation on $(precip_time[1])")
```

```{julia}
years 2001:2010

var_data_list = []
time_data_list = []
lon_data_list = []
lat_data_list = []

 for year in years
        # Download 2m air temperature for the year 2020
       temporary_Variable = NCDataset(joinpath(data_dir, "2m_temperature_$year.nc"))
       temp_values = temporary_Variable["t2m"][:,:,:]
       
       accumulator = concatonate(accumulator,temp_values,dims = 3)
       close(temparary_Variable)
end


```
## 2b. Temperature Data

```{julia}
temp_time = t2m["time"]
temp_time = temp_time[1:392737]
```

```{julia}
temp_lon = t2m["longitude"]
```
```{julia}
temp_lat = t2m["latitude"]
temp_lat = reverse(temp_lat)
```
```{julia}
temp = t2m["t2m"]
```
```{julia}
temp = temp .* 1u"K"
```

```{julia}
# Define a function to calculate daily averages
function hourly_to_daily(time, data)
    # Calculate the date part of each DateTime value
    dates = Date.(time)

    # Group data by date and calculate daily averages
    daily_data = aggregate(data, dates, mean)
    
    # Extract the date from the grouped data
    daily_time = first.(daily_data[1, :])

    return daily_time, daily_data[2]
end

# Convert hourly to daily
temp_time_daily, temp_daily = hourly_to_daily(temp_time, temp)
```

# 3. Splitting Data
```{julia}

